/************ Syphilis Session Table *******************/
create table s_session
(
	patient_identifier varchar(510) not null,
	session_id bigint not null
		constraint s_session_pk
			primary key,
	person_id integer not null
		constraint fkdoe8vddj6tlqdq9pvfq9gw71k
			references f_person,
	job_id bigint,
	status varchar(12) not null,
	status_url varchar(255),
	last_updated timestamp default CURRENT_TIMESTAMP not null,
	server_url varchar(255) not null
);

comment on table s_session is 'Syphilis Registry Request Session Information';

alter table s_session owner to postgres;

create index s_session_person_id_session_id_job_id_index
	on s_session (person_id, session_id, job_id);

/************ Syphilis Session Log Table *******************/
create table s_session_logs
(
	session_log_id bigint not null
		constraint s_session_logs_pk
			primary key,
	session_id bigint not null
		constraint fkfrcmn52dj357c632rebe6u2ey
			references s_session,
	datetime timestamp default CURRENT_TIMESTAMP not null,
	text varchar(510)
);

comment on table s_session_logs is 'Logging all session operations';

alter table s_session_logs owner to postgres;

/************ Syphilis FHIR Resource Deduplication Table  *******************/
create table f_resource_deduplicate
(
	id integer not null
		constraint f_resource_deduplicate_pk
			primary key,
	domain_id varchar(20) not null,
	omop_id bigint not null,
	fhir_resource_type varchar not null,
	fhir_identifier_system varchar not null,
	fhir_identifier_value varchar not null
);

alter table f_resource_deduplicate owner to postgres;

create unique index f_resource_deduplicate_id_uindex
	on f_resource_deduplicate (id);

